{% extends "layout.html" %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/default2_typing.css') }}">
    <script src="../static/scripts/sentLevelJquery.js"></script>
    <script src="../static/scripts/sentLevel_typing.js" type="text/javascript"></script>
    <script src="../static/scripts/doclevel.js" type="text/javascript"></script>
    <script src="../static/scripts/utils_typing.js" type="text/javascript"></script>
    <script src="../static/scripts/penmanString2umrDict_typing.js" type="text/javascript"></script>
    <script src="../static/scripts/umrDict2penmanString.js" type="text/javascript"></script>
    <script src="../static/scripts/BlobBuilder.js"></script>
    <script src="../static/scripts/FileSaver.js"></script>
    <script src="../static/scripts/partialGraph.js" type="text/javascript"></script>

    <script src="../static/scripts/javascript-lemmatizer/bower_components/underscore/underscore.js"></script>
    <script src="../static/scripts/javascript-lemmatizer/js/lemmatizer.js"></script>
{% endblock head %}

<div class="wrapper">
{% block content %}

<div class="annotation-display">
    <button type="button" onclick=toggle_info()>{{filename}}</button>
    <div id="info">
        <table>
            <tr>
                <th class='text-muted'>Annotator:</th>
                <th id="username">{{ owner.username }}</th>
                <th class='text-muted'>Annotator ID:</th>
                <th id="user_id">{{ owner.id }}</th>
            </tr>
            <tr>
                <th class='text-muted'>File Name:</th>
                <th id="filename" style="display:inline">{{ filename }}</th>
                <th class='text-muted'>File Language:</th>
                <th id="lang" style="display:inline">{{ lang }}</th>
            </tr>
                <tr>
                <th class='text-muted'>Doc ID in database:</th>
                <th id="doc_id" style="display:inline">{{ doc_id }}</th>
                <th class='text-muted'>File format:</th>
                <th id="file_format" style="display:inline">{{ file_format }}</th>
            </tr>
            </tr>
                <tr>
                <th class='text-muted'>Project Name:</th>
                <th id="project_name" style="display:inline">{{ project_name }}</th>
                <th class='text-muted'>Project Admin:</th>
                <th id="project_admin" style="display:inline">{{ admin.username }}</th>
            </tr>
        </table>
    </div>
    <hr>

    {# display all the sentences #}
    <div id="all-sentences" style="height: auto; overflow-y: scroll; max-height: 100px;">
        <script type="text/javascript">
            initialize({{ frame_dict|tojson|safe }}, "{{ lang }}",`{{ partial_graphs_json |tojson|safe}}`)
        </script>
        {% autoescape off %}
        <p>{{ info2display.sents_html }}</p>
        {% endautoescape %}
    </div>
    <hr>
    <div id="locate_page"></div>
    <form method="post" >
        <p>Line ID:
            <span id="curr_shown_sent_id" style="display: none"> {{ snt_id }}</span>
            <input type="number" name="sentence_id" id="sentence_id" size=8 min=1 max={{ info2display.sents|length }} value={{ snt_id }}>
            <input type="submit" name="set_sentence" id="set_sentence" size=6 value="go"><br>
        </p>
    </form>

    <div id="error_msg">
    </div>
    <script type="javascript">
        var scroll_=document.getElementById('scroll_pos')
        console.log(getScrollTop())
        scroll_.value=getScrollTop()

    </script>



    {# display the sentence with the chosen sentence ID #}
    {% if info2display.df_htmls|length and file_format != 'plain_text' %}
        <div id="sentence">
            Current Line:
            {% autoescape off %}
            <p>{{ info2display.df_htmls[snt_id-1] }}</p>
            {% endautoescape %}
            <p><b>Free(en)</b> {{ info2display.gls[snt_id-1][0] }}</p>
            <p><b>Free(es)</b> {{ info2display.gls[snt_id-1][1] }}</p>
            <p><b>Notes</b> {{ info2display.notes[snt_id-1] }}</p>

            {% if snt_id < info2display.df_htmls|length %}
                Next Line:
                <div id="table2">
                    {% autoescape off %}

                    <p>{{ info2display.df_htmls[snt_id] }}</p>
                    {% endautoescape %}
                    <p><b>Free(en)</b> {{ info2display.gls[snt_id][0] }}</p>
                    <p><b>Free(es)</b> {{ info2display.gls[snt_id][1] }}</p>
                    <p><b>Notes</b> {{ info2display.notes[snt_id] }}</p>
                </div>
            {% endif %}

        </div>
        <button class="btn btn-info btn-sm" id="show-more-info" onclick="toggleRow('optional-rows'); changeButton('show-more-info'); ">show less info</button>
    {% else %}
        <div id="sentence">
            {% autoescape off %}
            <p>{{ info2display.sent_htmls[snt_id-1] }}</p>
            {% endautoescape %}
        </div>
    {% endif %}


    <div id="sentence_display" class="sentence_display_test"></div>


        <div>

              <hr style="color: #5f8a7e">  <p id="penman" style="font-size: 7px"> UMR Penman Annotation:</p>
                <div id="amr">
                </div>
            </div>
<hr>
    <input class='command' id='main-command' oninput="onInputHandler(event,'{{ lang }}')" placeholder="e.g: 'top x5' or 'x5 :ARG1 x2'">

    <button  id="frame_button" >English frame</button>
    <div style="display: inline-flex; float: right" >
         <form method="post">


         <input type="text" id="sentence_id" name="sentence_id" style="display: none" value="{{ snt_id -(1) if snt_id>1 else 1 }}">
         <input   type="text" id="scroll_pos" name="scroll_pos" style="display: none" value="">
             <input type="submit"  name="set_sentence" id="set_sentence" size=6 value="previous" onclick="UMR2db()"><br>

    </form>
     <form method="post">


         <input type="text" id="sentence_id" name="sentence_id" style="display: none" value="{{ snt_id +(1) if snt_id<info2display.sents|length else (info2display.sents|length) }}">
          <input   type="text" id="scroll_pos" name="scroll_pos" style="display: none" value="">
         <input type="submit" name="set_sentence" id="set_sentence" size=6 value="next" onclick="UMR2db()"><br>

    </form>
    <button class="btn btn-info btn" id="umr2db" onclick="UMR2db()">save</button>
    </div>

    <div style="height: 10%; width:90%; margin-top: 40px">
            <button class="btn btn-info btn" id="umr2db" onclick="UMR2db()">save</button>
            <button class="btn btn-info btn" id="export-box" onclick="export_annot({{ exported_items}}, `{{content_string }}`)">export</button>
            <button class="btn btn-info btn" id="replace-box" onclick="changeShowStatus('replace');">edit</button>
            <button class="btn btn-info btn" id="delete-box" onclick="changeShowStatus('delete');">mdelete</button>
            <button class="btn btn-info btn" id="undo-button" title="currently nothing to undo" onclick="undo(-1);">undo</button>
            <button class="btn btn-info btn" id="redo-button" title="currently nothing to undo" onclick="undo(1);">redo</button>
            <button class="btn btn-info btn" id="reset-box" onclick="reset();">reset</button>
            <button class="btn btn-info btn" id="one-line-ne" onclick="changeSetting();">one-line NE</button>
            <button class="btn btn-info btn" id ="load" onclick="set_load_visible('load-table');">load</button>
            <button class="btn btn-info btn" id ="load" onclick="set_load_visible('move_box');">move</button>
            <button class="btn btn-info btn" id ="load" onclick="set_load_visible('replace_box');">replace</button>
            <button class="btn btn-info btn" id ="load" onclick="set_load_visible('delete_box');">tdelete</button>

        <input style="display: none"  placeholder="move + branch head node + to + new head + role, e.g: move x2 to x3 :ARG5"  class="command" id="move_box" >
        <input style="display: none"  oninput="onInputHandler(event,'{{ lang }}')" class="command" id="replace_box"  placeholder="replace + concept + at + variable with new variable, e.g:replace concept at x1 with x2">
        <input style="display: none" class="command" id ="delete_box"  placeholder=" delete+ head+roles+variable, e.g:delete x2 :ARG1 x3">
    frame info:
    {{ frame_info }}
    <p id="frame_info"></p>
            <hr>
            <a class="btn btn-info btn-sm" id="annot-button" title="click to do doc-level annotation" href="{{ url_for('main.doclevel', doc_sent_id=doc_id ~ '_' ~ snt_id ~ '_' ~ owner.id, _anchor='amr') }}" onclick="UMR2db()">doc level annot</a>
            <a class="btn btn-info btn-sm" id="lexicon" title="click to do get/edit current suggest lemma" href="{{ url_for('main.lexiconlookup', project_id=project_id, doc_id=doc_id, snt_id=snt_id) }}" onclick="UMR2db(); get_selected_word()">lexicon lookup</a>
            <a class="btn btn-info btn-sm" id="lexicon" title="click to do get/edit current suggest lemma" href="{{ url_for('main.lexiconadd', project_id=project_id, doc_id=doc_id, snt_id=snt_id) }}" onclick="UMR2db(); get_selected_word()">add to Lexicon</a>
            <a class="btn btn-info btn-sm" id="search" title="search" href="{{ url_for('users.search', project_id=0) }}" onclick="UMR2db()">search</a>
            <a class="btn btn-info btn-sm" id="pg-button" title="click to show all partial graphs" href="{{ url_for('users.partialgraph', project_id=project_id) }}" onclick="UMR2db()">show partial graphs</a>
            <a class="btn btn-info btn-sm" title="click to show all lexicon" href="{{ url_for('users.alllexicon', project_id=project_id) }}" onclick="UMR2db()">show all lexicon</a>
            <a class="btn btn-info btn-sm" id="annot-button" title="click to go back to project page" href="{{ url_for('users.project', project_id=project_id) }}" onclick="UMR2db()">back to project</a>
        </div>
    <hr>
        <div style="display: none">
                <p> Edit History:</p>
                <div id="eh"></div>
                <textarea id="edit_history"></textarea>
                <button class="btn btn-info btn-sm" type="button" onclick="goToEdit(document.getElementById('edit_history').value)">enter the edit number</button>

                <p id="edit_history"></p>
            </div>
<div id="load-table" style="display: none">
        <table>
	      <tbody><tr>
		<td><b>Direct AMR Entry</b> &nbsp; e.g. using cut and paste</td>
	      </tr>
	      <tr>
		<td>
                  <textarea rows="20" cols="80" id="load-plain" name="load-plain" autocapitalize="off" autocorrect="off" spellcheck="false" style="overflow:auto;"></textarea>
		</td>
	      </tr>
	      <tr>
		<td>
		  <table width="40" border="1" cellpadding="1" cellspacing="0"><tbody><tr style="background-color:#BBCCFF;"><td align="center"><nobr>&nbsp;<a style="text-decoration:none" title="click to load amr from text area" onclick="load2mar();" ><font color="black">load direct AMR</font></a>&nbsp;</nobr></td></tr></tbody></table>
		</td>
	      </tr>
	    </tbody></table>
        </div>

</div>
{% endblock content %}

{% block content2 %}
    <div class="frame_display_info"  style=" float: right; margin-right: 50px;  top:10%;">
        <div id="frame_display" style="width: fit-content">
        <script type="text/javascript">
            colorAnnotatedSents('{{ annotated_sent_ids }}');
            loadHistory('{{ curr_sent_umr|tojson|safe }}', `{{ curr_annotation_string }}`, `{{ curr_alignment |tojson|safe}}`);
            selectEvent();
            customizeOptions(`{{ aspectSettingsJSON |tojson|safe}}`, "aspect-attr");
            customizeOptions(`{{ personSettingsJSON |tojson|safe}}`, "refer-person-attr");
            customizeOptions(`{{ numberSettingsJSON |tojson|safe}}`, "refer-number-attr");
            customizeOptions(`{{ modalSettingsJSON |tojson|safe}}`, "modstr-values");
            customizeOptions(`{{ discourseSettingsJSON |tojson|safe}}`, "default-roles_abstract-concepts");
            populatePartialGraphOptionList();
            getframe(document.getElementById('query_token').value)
        </script>
        </div>
    </div>
{% endblock content2 %}
</div>




